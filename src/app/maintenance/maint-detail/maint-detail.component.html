<app-header></app-header>

<!-- <pre>{{ maintenance | json }}</pre> -->
<div class="container-custom" *ngIf="maintenanceUrl?.maintenance">
    <div class="row">

        <!-- primer accordion -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button button-lila-obscuro"
                    type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true"
                    aria-controls="collapseOne">
                    Detalle del problema1:
                    <b>{{ maintenanceUrl.maintenance.type_incident }}</b> -
                    {{ maintenanceUrl.maintenance.case.created }}
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show"
                aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <p>
                        <b>Descripción del problema:</b>
                        {{ maintenanceUrl.maintenance.description_incident
                        }}
                    </p>
                    <p>
                        <b>Sitio del problema: </b>
                        {{ maintenanceUrl.maintenance.site }}
                    </p>
                    <p>
                        <b>Prioridad: </b>
                        {{ maintenanceUrl.maintenance.priority }}
                    </p>
                    <p>
                        <b>Estado: </b>
                        {{ maintenanceUrl.maintenance.case.status.name }}
                    </p>
                </div>
            </div>
        </div>
        <!-- primer accordion -->

        <!-- segundo acordion -->

        <div >

            <form *ngIf="isAdmin" (ngSubmit)="onSubmit()">

                <!-- fecha estimada -->
                <div class="form-group">
                    <label for="date_estimated_delivery">
                        Fecha de entrega:
                    </label>
                    <input type="date" id="date_estimated_delivery"
                        name="date_estimated_delivery" class="form-control"
                        [(ngModel)]="mainDetalle.date_estimated_delivery"
                        required>
                </div>

                <!-- fecha estimada -->

                <!-- nivel de prioridad -->
                <b>Opción seleccionada: {{ mainDetalle.priority
                    }}</b>
                <div class="form-group"
                    *ngFor="let option of ['Baja', 'Media', 'Alta']">
                    <label for="priority">
                        <input type="radio" id="priority"
                            name="priority" class="form-control"
                            [(ngModel)]="mainDetalle.priority"
                            [value]="option"
                            required>
                        {{ option }}
                    </label>

                </div>

                <!-- nivel de prioridad -->

                <!-- tiene riesgo -->

                <b>¿Tiene riesgo? {{ mainDetalle.has_risk == true ?
                    'SI' : 'NO'}}</b>
                <div class="form-group">

                    <label>
                        <input type="radio" name="has_risk"
                            [(ngModel)]="mainDetalle.has_risk" [value]="true">
                        SI
                    </label>

                    <label>
                        <input type="radio" name="has_risk"
                            [(ngModel)]="mainDetalle.has_risk" [value]="false">
                        NO
                    </label>

                </div>

                <!-- tiene riesgo -->

                <!-- inicia para el cambio de estado del caso y la asignacion -->

                <div class="form-group">
                    <label for="estado"><b>Estado: </b></label>
                    <select name="status_id" id="status_id"
                        [(ngModel)]="mainDetalle.status_id">
                        <option *ngFor="let param of params"
                            [value]="param.id">{{
                            param.name }}</option>
                    </select>

                </div>

                <div class="form-group">
                    <label for="user_to_assign_id"><b>Asignado a: </b></label>
                    <select *ngIf="usersUrl && usersUrl.users"
                        name="user_to_assign_id" id="user_to_assign_id"
                        [(ngModel)]="mainDetalle.user_to_assign_id">
                        <option *ngFor="let user of usersUrl.users"
                            [value]="user.id">{{ user.first_name }} {{
                            user.last_name }}</option>
                    </select>

                </div>

                <!-- fin para el cambio de estado del caso y la asignacion -->

                <!-- para la solución -->
                <div class="row">
                    <div class="form-group" style="margin-top: 10px;">
                        <label for="comments">Solución:</label>
                        <textarea class="form-control" name="solution"
                            [(ngModel)]="mainDetalle.solution"
                            [value]="mainDetalle.solution"
                            rows="6">
                  </textarea>
                    </div>
                </div>
                <!-- fin para la solucion -->

                <button type="submit">Enviar</button>
            </form>

        </div>
        <!-- fin formulario -->

        <!-- inicio de upload de foto -->
        <div style="border: solid 1px #E0E0E0; 
        margin: 30px; padding: 30px;
        background-color: #D3D3E4;">
            <input type="file" #fileInput class="form-control" />
            <button (click)="uploadFile()" class="btn btn-primary">Subir
                archivo</button>
        </div>

        <!-- fin de upload de fotos -->

        <!-- segundo acordion -->

        <!-- inicia fotos -->
        <div class="row" style="margin-top: 10px;">
            <div class="col-lg-12">

                <div class="row">
                    <b>GALERÍA DE FOTOS CON EL PROBLEMA</b>

                    <ng-container
                        *ngFor="let photo of maintenanceUrl.maintenance.photos">
                        <div class="col" *ngIf="photo.is_before">
                            <a data-bs-toggle="modal"
                                data-bs-target="#exampleModal"
                                (click)="viewPhotoModal(photo.photo)">
                                <img src="{{ urlPhotos + photo.photo }}"
                                    alt="..." class="img-thumbnail"
                                    width="100px">
                            </a>
                        </div>
                    </ng-container>
                </div>

                <hr>

                <div class="row" style="margin-top: 25px;">
                    <b>GALERÍA DE FOTOS DESPUÉS DEL ARREGLO</b>
                    <ng-container
                        *ngFor="let photo of maintenanceUrl.maintenance.photos">
                        <div class="col button" *ngIf="!photo.is_before">
                            <a data-bs-toggle="modal"
                                data-bs-target="#exampleModal"
                                (click)="viewPhotoModal(photo.photo)">
                                <img src="{{urlPhotos + photo.photo }}"
                                    alt="..." class="img-thumbnail"
                                    width="100px">
                            </a>
                        </div>
                    </ng-container>
                </div>

            </div>
        </div>
        <!-- Fin fotos -->

        <!-- inicia modal de fotos -->
        <div class="modal fade" id="exampleModal" tabindex="-1"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">{{
                            photografy }}</h5>
                        <button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <img
                            src="/assets/files/uploads/maintenances/{{ photografy }}"
                            alt="..." class="img-thumbnail" width="100%">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- fin modal de fotos -->

    </div>

</div>